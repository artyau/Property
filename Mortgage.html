<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ  å°ˆæ¥­æŒ‰æ­è¨ˆç®—å™¨ - å®åˆ©é¢¨æ ¼</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght=400;700&display=swap" rel="stylesheet">
    <style>
        /* ğŸ¨ CSS æ¨£å¼ï¼šæ¨¡æ“¬ Manulife.com.hk çš„å°ˆæ¥­é¢¨æ ¼ */

        :root {
            --primary-color: #003366; /* å®åˆ©æ·±è—è‰² */
            --secondary-color: #00a88f; /* å®åˆ©ç¶ è‰²/è¡Œå‹•å‘¼ç±²è‰² */
            --background-color: #f4f6f9; /* è¼•å¾®ç°çš„èƒŒæ™¯ */
            --card-background: #ffffff;
            --text-color: #333333;
            --border-radius: 6px;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* æŸ”å’Œé™°å½± */
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1100px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 2.5em;
            border-bottom: 3px solid var(--secondary-color); 
            display: inline-block;
            padding-bottom: 8px;
        }
        
        header p {
            color: #555;
        }

        /* è¼¸å…¥èˆ‡çµæœå¡ç‰‡ä½ˆå±€ */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: var(--card-background);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-top: 5px solid var(--primary-color); /* å¼·èª¿å°ˆæ¥­æ„Ÿ */
        }

        /* è¼¸å…¥è¡¨å–®æ¨£å¼ */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 700;
            color: var(--text-color);
            font-size: 1em;
        }

        input[type="number"] {
            width: calc(100% - 24px); 
            padding: 12px;
            border: 1px solid #cccccc;
            border-radius: 4px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 51, 102, 0.25); 
        }

        .input-addon {
            display: flex;
            align-items: center;
        }

        .input-addon span {
            margin-left: 10px;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* è¨ˆç®—æŒ‰éˆ• */
        #calculate-btn {
            width: 100%;
            padding: 15px;
            background-color: var(--secondary-color); 
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }

        #calculate-btn:hover {
            background-color: #007f6e; 
        }
        #calculate-btn:active {
            transform: scale(0.99);
        }

        /* çµæœé¡¯ç¤ºæ¨£å¼ */
        #result-output {
            text-align: center;
            display: none; 
        }

        .monthly-payment-box {
            background-color: #e6f7ff; 
            border: 1px solid var(--primary-color);
            padding: 25px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .payment-label {
            font-size: 1.2em;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-weight: 400;
        }

        .payment-amount {
            font-size: 3.5em;
            font-weight: 700;
            color: var(--secondary-color); 
            line-height: 1;
        }

        /* ç¸½çµæ•¸æ“šè¡Œ */
        #result-output p {
            font-size: 1em;
            text-align: left;
            margin: 8px 0;
        }

        #result-output strong {
            color: var(--primary-color);
        }
        #result-output span {
            font-weight: 700;
        }

        /* è¡¨æ ¼æ¨£å¼ */
        #amortization-schedule {
            display: none; 
            width: 100%;
            overflow-x: auto; 
            margin-top: 30px;
        }
        
        #amortization-schedule h2 {
            color: var(--primary-color);
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        #schedule-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            box-shadow: var(--shadow); 
        }

        #schedule-table thead {
            background-color: var(--primary-color);
            color: white;
            position: sticky; 
            top: 0;
            z-index: 10;
        }

        #schedule-table th, #schedule-table td {
            padding: 12px 15px;
            text-align: right;
            border: 1px solid #e9ecef; 
        }

        #schedule-table th:first-child, #schedule-table td:first-child {
            text-align: center; 
        }

        #schedule-table tbody tr:nth-child(even) {
            background-color: #f8f8f8; 
        }

        #schedule-table tbody tr:hover {
            background-color: #eef2f5; 
        }

        @media (max-width: 900px) {
            .main-grid {
                grid-template-columns: 1fr; 
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>å°ˆæ¥­æŒ‰æ­é‚„æ¬¾è¨ˆç®—å™¨</h1>
            <p>ä½¿ç”¨ç­‰é¡æœ¬æ¯æ³•ï¼Œç²¾æº–è¨ˆç®—æ‚¨çš„æ¯æœˆä¾›æ¬¾èˆ‡åˆ†æœŸæ”¤é‚„è©³æƒ…ã€‚</p>
        </header>

        <div class="main-grid">
            <div class="card input-card">
                <h2>è¼¸å…¥æŒ‰æ­è³‡è¨Š</h2>
                
                <div class="form-group">
                    <label for="property-value">ç‰©æ¥­åƒ¹å€¼ (æ¸¯å…ƒ)</label>
                    <input type="number" id="property-value" value="5000000" min="100000" required>
                </div>
                
                <div class="form-group">
                    <label for="loan-percentage">æŒ‰æ­æˆæ•¸ (%)</label>
                    <div class="input-addon">
                        <input type="number" id="loan-percentage" value="70" min="1" max="100" required>
                        <span>%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loan-term">æŒ‰æ­å¹´æœŸ (å¹´)</label>
                    <div class="input-addon">
                        <input type="number" id="loan-term" value="25" min="1" max="50" required>
                        <span>å¹´</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="annual-rate">æŒ‰æ­å¹´åˆ©ç‡ (%)</label>
                    <div class="input-addon">
                        <input type="number" id="annual-rate" value="4.125" min="0.01" step="0.01" required>
                        <span>%</span>
                    </div>
                </div>
                
                <button id="calculate-btn">é–‹å§‹è¨ˆç®—</button>
            </div>

            <div class="card" id="result-output">
                <h2>è¨ˆç®—çµæœç¸½è¦½</h2>

                <div class="monthly-payment-box">
                    <div class="payment-label">æ¯æœˆä¾›æ¬¾é¡ (æ¸¯å…ƒ)</div>
                    <div class="payment-amount" id="monthly-payment-amount">--</div>
                </div>

                <div style="margin-top: 30px; text-align: left;">
                    <p><strong>è²¸æ¬¾ç¸½é¡:</strong> <span id="total-loan-principal">--</span> HKD</p>
                    <p><strong>é‚„æ¬¾ç¸½åˆ©æ¯:</strong> <span id="total-interest-paid">--</span> HKD</p>
                    <p><strong>ç¸½é‚„æ¬¾é¡:</strong> <span id="total-repayment">--</span> HKD</p>
                </div>
            </div>
        </div>
        
        <div id="amortization-schedule">
            <h2>æŒ‰æ­åˆ†æœŸæ”¤é‚„è¡¨ (ç´°ç¯€)</h2>
            <table id="schedule-table">
                <thead>
                    <tr>
                        <th>æœŸæ•¸ (æœˆ)</th>
                        <th>é¤˜ä¸‹åˆå§‹é¤˜é¡ (HKD)</th>
                        <th>æ¯æœˆä¾›æ¬¾é¡ (HKD)</th>
                        <th>ä¾›æ¬¾åˆ©æ¯éƒ¨åˆ† (HKD)</th>
                        <th>ä¾›æ¬¾æœ¬é‡‘éƒ¨åˆ† (HKD)</th>
                        <th>é‚„å®Œä¹‹å¾Œé¤˜é¡ (HKD)</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // ğŸ’» JavaScript é‚è¼¯ï¼šæŒ‰æ­è¨ˆç®—æ ¸å¿ƒ

        const propertyValueInput = document.getElementById('property-value');
        const loanPercentageInput = document.getElementById('loan-percentage');
        const loanTermInput = document.getElementById('loan-term');
        const annualRateInput = document.getElementById('annual-rate');
        const calculateBtn = document.getElementById('calculate-btn');
        
        const resultOutput = document.getElementById('result-output');
        const monthlyPaymentAmount = document.getElementById('monthly-payment-amount');
        const totalLoanPrincipal = document.getElementById('total-loan-principal');
        const totalInterestPaid = document.getElementById('total-interest-paid');
        const totalRepayment = document.getElementById('total-repayment');
        const amortizationSchedule = document.getElementById('amortization-schedule');
        const scheduleTableBody = document.querySelector('#schedule-table tbody');

        /**
         * æ ¼å¼åŒ–æ•¸å­—ç‚ºåƒä½åˆ†éš”ç¬¦ï¼Œä¸¦ä¿ç•™å°æ•¸é»å¾Œå…©ä½
         * @param {number} num 
         * @returns {string} 
         */
        const formatCurrency = (num) => {
            return num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        };

        /**
         * æ ¸å¿ƒè¨ˆç®—ï¼šç­‰é¡æœ¬æ¯é‚„æ¬¾æ³•ï¼ˆPMT å…¬å¼ï¼‰
         * @param {number} P - è²¸æ¬¾æœ¬é‡‘ (Principal)
         * @param {number} r - æœˆåˆ©ç‡ (Monthly Interest Rate)
         * @param {number} n - ç¸½æœŸæ•¸ (Total Number of Payments)
         * @returns {number} æ¯æœˆä¾›æ¬¾é¡
         */
        function calculateMonthlyPayment(P, r, n) {
            if (r === 0) {
                return P / n;
            }
            // ç­‰é¡æœ¬æ¯å…¬å¼ï¼šM = P [ r(1 + r)^n ] / [ (1 + r)^n â€“ 1 ]
            const power = Math.pow(1 + r, n);
            const monthlyPayment = P * (r * power) / (power - 1);
            return monthlyPayment;
        }

        /**
         * ç¶å®šè¨ˆç®—æŒ‰éˆ•äº‹ä»¶
         */
        calculateBtn.addEventListener('click', () => {
            // 1. ç²å–ä¸¦è™•ç†è¼¸å…¥åƒæ•¸
            const propertyValue = parseFloat(propertyValueInput.value);
            const loanPercentage = parseFloat(loanPercentageInput.value) / 100;
            const loanTermYears = parseFloat(loanTermInput.value);
            const annualRate = parseFloat(annualRateInput.value) / 100;

            // åƒæ•¸æª¢æŸ¥
            if (isNaN(propertyValue) || isNaN(loanPercentage) || isNaN(loanTermYears) || isNaN(annualRate) || propertyValue <= 0 || loanTermYears <= 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æŒ‰æ­åƒæ•¸ï¼');
                return;
            }

            // æ›ç®—æˆè¨ˆç®—æ‰€éœ€å–®ä½
            const principal = propertyValue * loanPercentage; // è²¸æ¬¾æœ¬é‡‘ (P)
            const monthlyRate = annualRate / 12; // æœˆåˆ©ç‡ (r)
            const totalPayments = loanTermYears * 12; // ç¸½æœˆæ•¸ (n)
            
            // 2. è¨ˆç®—æ¯æœˆä¾›æ¬¾é¡
            const monthlyPayment = calculateMonthlyPayment(principal, monthlyRate, totalPayments);

            // 3. ç”Ÿæˆåˆ†æœŸæ”¤é‚„è¡¨ä¸¦è¨ˆç®—ç¸½åˆ©æ¯
            let remainingBalance = principal;
            let totalInterest = 0;
            scheduleTableBody.innerHTML = ''; // æ¸…ç©ºèˆŠçš„è¡¨æ ¼å…§å®¹

            for (let month = 1; month <= totalPayments; month++) {
                const startBalance = remainingBalance;
                
                // è¨ˆç®—ç•¶æœˆåˆ©æ¯ C = A * r
                const interestPayment = startBalance * monthlyRate;
                totalInterest += interestPayment;
                
                // è¨ˆç®—ç•¶æœˆæœ¬é‡‘ D = B - C
                let principalPayment = monthlyPayment - interestPayment;

                // ä¿®æ­£æœ€å¾Œä¸€æœŸè¨ˆç®—èª¤å·®
                if (month === totalPayments) {
                    principalPayment = remainingBalance; // æœ€å¾Œä¸€æœŸæœ¬é‡‘å‰›å¥½ç­‰æ–¼å‰©é¤˜æœ¬é‡‘
                    remainingBalance = 0;
                } else {
                    remainingBalance -= principalPayment;
                }

                // ç¢ºä¿é¤˜é¡ä¸æœƒæ˜¯æ¥µå°çš„è² æ•¸ï¼ˆç”±æ–¼æµ®é»æ•¸èª¤å·®ï¼‰
                if (remainingBalance < 0 && month === totalPayments) {
                    remainingBalance = 0;
                }
                
                // å‰µå»ºè¡¨æ ¼è¡Œ (tr)
                const row = scheduleTableBody.insertRow();
                
                // å¡«å……è¡¨æ ¼æ•¸æ“š (td)
                row.insertCell(0).textContent = month; // æœŸæ•¸
                row.insertCell(1).textContent = formatCurrency(startBalance); // é¤˜ä¸‹åˆå§‹é¤˜é¡
                row.insertCell(2).textContent = formatCurrency(monthlyPayment); // æ¯æœˆä¾›æ¬¾é¡
                row.insertCell(3).textContent = formatCurrency(interestPayment); // ä¾›æ¬¾åˆ©æ¯éƒ¨åˆ†
                row.insertCell(4).textContent = formatCurrency(principalPayment); // ä¾›æ¬¾æœ¬é‡‘éƒ¨åˆ†
                row.insertCell(5).textContent = formatCurrency(remainingBalance); // é‚„å®Œä¹‹å¾Œé¤˜é¡
            }

            // 4. é¡¯ç¤ºçµæœç¸½çµ
            const totalRepay = principal + totalInterest;

            monthlyPaymentAmount.textContent = formatCurrency(monthlyPayment);
            totalLoanPrincipal.textContent = formatCurrency(principal);
            totalInterestPaid.textContent = formatCurrency(totalInterest);
            totalRepayment.textContent = formatCurrency(totalRepay);

            // é¡¯ç¤ºçµæœå€å’Œè¡¨æ ¼
            resultOutput.style.display = 'block';
            amortizationSchedule.style.display = 'block';
        });

        // é é¢åŠ è¼‰æ™‚è‡ªå‹•åŸ·è¡Œä¸€æ¬¡è¨ˆç®—ï¼Œä»¥é¡¯ç¤ºåˆå§‹å€¼
        window.onload = () => {
             // ç¢ºä¿æ‰€æœ‰è¼¸å…¥å…ƒç´ å·²åŠ è¼‰ï¼Œå†æ¨¡æ“¬é»æ“Š
             if(propertyValueInput.value) { 
                 calculateBtn.click();
             }
        };

    </script>
</body>
</html>
